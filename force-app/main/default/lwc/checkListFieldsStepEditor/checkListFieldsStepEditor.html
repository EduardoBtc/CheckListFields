<template>
    <div class="slds-p-around_small">
        <div class="slds-text-title_caps slds-m-bottom_small">
            Selecione os campos a serem verificados para {step.label}
        </div>

        <div class="slds-grid slds-gutters slds-m-bottom_medium">
            <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12">
                <lightning-input type="search" label="Pesquisar campos" placeholder="Digite para pesquisar..."
                    onchange={handleSearchChange} variant="label-hidden">
                </lightning-input>
            </div>
            <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-grid slds-grid_vertical-align-end">
                <div class="slds-checkbox slds-p-right_medium">
                    <lightning-input type="checkbox" label="Mostrar apenas selecionados" onchange={handleToggleSelected}
                        checked={showSelectedOnly}>
                    </lightning-input>
                </div>
                <div class="slds-button-group">
                    <lightning-button label="Selecionar Todos" variant="brand-outline" onclick={handleSelectAll}
                        class="slds-m-right_x-small">
                    </lightning-button>
                    <lightning-button label="Desmarcar Todos" variant="destructive-text" onclick={handleDeselectAll}>
                    </lightning-button>
                </div>
            </div>
        </div>

        <div class="slds-text-body_small slds-m-bottom_small">
            {selectedCount} de {totalCount} campos selecionados
        </div>

        <div class="slds-grid slds-wrap slds-gutters_direct slds-scrollable" style="max-height: 400px;">
            <template for:each={filteredFields} for:item="field">
                <div key={field.value}
                    class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_4-of-12 slds-p-vertical_x-small">
                    <lightning-input type="checkbox" label={field.label} data-field={field.value}
                        checked={field.checked} onchange={handleFieldChange}>
                    </lightning-input>
                </div>
            </template>
        </div>

        <template if:false={filteredFields.length}>
            <div class="slds-illustration slds-illustration_small">
                <div class="slds-text-longform">
                    <p class="slds-text-align_center">
                        <template if:true={searchTerm}>
                            Nenhum campo encontrado para "{searchTerm}"
                        </template>
                        <template if:false={searchTerm}>
                            Nenhum campo dispon√≠vel
                        </template>
                    </p>
                </div>
            </div>
        </template>
    </div>
</template>